<!DOCTYPE html>
<html lang="en"><head>
    





<title>javascript - file upload | tedshd&#39;s DevNote</title>

<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content='javascript - file upload Introduction 利用 javascript 達到檔案上傳的功能 顯示上傳進度 多檔上傳 取消上傳 拖拉上傳 斷點續傳?? chrome 上傳資料夾 盡可能跨 browser(for IE8) 不依攋任一 javascript library 自幹上傳 iframe upload in IE Skill files'>
<meta name="keywords" content=''>
<meta name="msapplication-TileColor" content="#b91d47">
<meta name="theme-color" content="#ffffff">

<link rel="canonical" href="http://blog.tedshd.io/posts/2013-10-20-javascript-file-upload/" />
<link rel="apple-touch-icon" sizes="180x180" href='/apple-touch-icon.png'>
<link rel="icon" type="image/png" sizes="32x32" href='/favicon-32x32.png'>
<link rel="icon" type="image/png" sizes="16x16" href='/favicon-16x16.png'>
<link rel="manifest" href='/site.webmanifest'>
<link rel="mask-icon" href='/safari-pinned-tab.svg' color="#696969">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="theme-color" content="#ffffff">

<meta property="og:title" content="javascript - file upload" />
<meta property="og:description" content="javascript - file upload Introduction 利用 javascript 達到檔案上傳的功能 顯示上傳進度 多檔上傳 取消上傳 拖拉上傳 斷點續傳?? chrome 上傳資料夾 盡可能跨 browser(for IE8) 不依攋任一 javascript library 自幹上傳 iframe upload in IE Skill files" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://blog.tedshd.io/posts/2013-10-20-javascript-file-upload/" />
<meta property="og:image" content="https://s3.amazonaws.com/logdown-production/system/blog/3202/og_image/logdown.png"/>
<meta property="article:published_time" content="2013-10-20T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-01-29T17:42:46+08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://s3.amazonaws.com/logdown-production/system/blog/3202/og_image/logdown.png"/>

<meta name="twitter:title" content="javascript - file upload"/>
<meta name="twitter:description" content="javascript - file upload Introduction 利用 javascript 達到檔案上傳的功能 顯示上傳進度 多檔上傳 取消上傳 拖拉上傳 斷點續傳?? chrome 上傳資料夾 盡可能跨 browser(for IE8) 不依攋任一 javascript library 自幹上傳 iframe upload in IE Skill files"/>

<meta itemprop="name" content="">
<meta itemprop="description" content="">
    
    
    
    
    
    <link rel="stylesheet" href='/css/style.css'>

    

</head><body><header id="navigation" class="p-navigation">
    <div class="p-navigation__row">
        <div class="p-navigation__banner">
            <div class="p-navigation__logo">
                <a class="p-navigation__link u-vertically-center p-link--logo" href="http://blog.tedshd.io/">
                    tedshd&#39;s DevNote
                </a>
            </div>
            
            <a href="#navigation" class="p-navigation__toggle--open" title="menu">
                <i class="p-icon--menu"></i>
            </a>
            <a href="#navigation-closed" class="p-navigation__toggle--close" title="close menu">
                <i class="p-icon--close"></i>
            </a>
        </div>

        <nav class="p-navigation__nav">
            <span class="u-off-screen">
                <a href="#main-content">Jump to main content</a>
            </span>

            <ul class="p-navigation__items" role="menu">
                
                <li class="p-navigation__item" role="menuitem">
                    <a class="p-navigation__link" href="http://blog.tedshd.io/categories">Categories</a>
                </li>
                
                <li class="p-navigation__item" role="menuitem">
                    <a class="p-navigation__link" href="http://blog.tedshd.io/tags">tags</a>
                </li>
                
            </ul>

            
            <form class="p-search-box" action="https://www.google.com/search" target="_blank">
    <input type="search" class="p-search-box__input" name="q" placeholder='Search'
        required="" aria-label="Query">
    <input type="hidden" name="sitesearch" value="http://blog.tedshd.io/">
    <button type="reset" class="p-search-box__reset" alt="reset" aria-label="Reset">
        <i class="p-icon--close"></i>
    </button>
    <button type="submit" class="p-search-box__button" alt="search" aria-label="Search">
        <i class="p-icon--search"></i>
    </button>
</form>
            
        </nav>
    </div>
</header><div id="main-content">
<header class="p-strip page-banner">
    <div class="row">
        <h1>javascript - file upload</h1>
    </div>

    

<div class="row">

    
    <div class="col-8">
        




<div class="p-media-object">

    

    <div class="p-media-object__details">

        

        
        <p class="p-media-object__content">
            <span class="u-capitalized">on</span>
            2013-10-20
        </p>
        

    </div>
</div>


    </div>
    

    

</div>




</header>

<section class="p-strip is-shallow">
    <main class="row post-content">
        <h2 id="javascript---file-upload">javascript - file upload</h2>
<h3 id="introduction">Introduction</h3>
<p>利用 javascript 達到檔案上傳的功能</p>
<ul>
<li>顯示上傳進度</li>
<li>多檔上傳</li>
<li>取消上傳</li>
<li>拖拉上傳</li>
<li><strong><a href="http://www.resumablejs.com/">斷點續傳??</a></strong></li>
<li>chrome 上傳資料夾</li>
<li>盡可能跨 browser(for IE8)</li>
<li>不依攋任一 javascript library</li>
<li><a href="http://www.dotblogs.com.tw/anfernee/archive/2011/08/25/34299.aspx">自幹上傳</a></li>
<li><a href="http://viralpatel.net/blogs/ajax-style-file-uploading-using-hidden-iframe/">iframe upload in IE</a></li>
</ul>
<h3 id="skill">Skill</h3>
<ul>
<li>files API</li>
<li>AJAX</li>
<li>iframe</li>
<li>FormData</li>
<li>&hellip;</li>
</ul>
<h3 id="develop">Develop</h3>
<ul>
<li>單純用 javascript</li>
<li>利用 AJAX 上傳</li>
<li>處理 AJAX 上傳在 IE 的問題(利用 iframe 也許可解, <a href="http://malsup.com/jquery/form/">Refer</a>)</li>
<li>處理拖拉</li>
<li>處理拖拉資料夾</li>
<li>處理預設樣式</li>
</ul>
<h3 id="issue">Issue</h3>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/FormData">FormData</a>
<ul>
<li>AJAX 上傳(IE10 以上)</li>
<li>IE 利用 iframe 實作</li>
</ul>
</li>
</ul>
<h3 id="dseign-flow">Dseign flow</h3>
<h4 id="attribute">Attribute</h4>
<ul>
<li>inputFileNode(input type file element)</li>
<li>fileName(<code>name=&quot;&quot;</code>)</li>
<li>server(the file upload to server url)</li>
<li>dropArea(set the drop area)</li>
</ul>
<h4 id="method">Method</h4>
<ul>
<li>upload</li>
<li><em>cancel</em></li>
</ul>
<h4 id="event">Event</h4>
<p>Use <a href="https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent">CustomEvent</a> (IE 9 up)
<a href="http://www.sitepoint.com/javascript-custom-events/">Refer - How to Create Custom Events in JavaScript</a></p>
<ul>
<li>selectFiles
<ul>
<li>e.fileList (Array)
<ul>
<li>name</li>
<li>size</li>
<li>type</li>
</ul>
</li>
<li>e.length (number)</li>
</ul>
</li>
<li><em>uploadError</em></li>
<li>uploadProgress
<ul>
<li>e.bytesLoaded (number)</li>
<li>e.bytesTotal (number)</li>
<li>e.percentLoaded (number)</li>
</ul>
</li>
<li><em>uploadComplete</em></li>
<li><em>dragenter</em></li>
<li><em>dragover</em></li>
<li><em>drop</em></li>
<li><em>drag</em></li>
</ul>
<h3 id="develop-log">develop log</h3>
<h4 id="how-to-do">How to do?</h4>
<p>Use JavaScript no require any library
Use AJAX to upload
Must know how to use XMLHttpRequest and use it upload file
Use FormData handle ajax upload files, but it only for IE 10
So IE maybe use iframe upload
Must easy to use
It has many useful method and event
Must handle custom event(have cross browser problem)
Use File API handle file list, it only for IE10</p>
<h4 id="about-code">About code</h4>
<p>Use querySelector replace getElementById、getElementsByTagName&hellip;etc(IE8 up)
<a href="https://developer.mozilla.org/en-US/docs/Web/API/document.querySelector">document.querySelector</a>
Use node method to reduce code</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JavaScript" data-lang="JavaScript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">node</span>;
<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">node</span> (<span style="color:#a6e22e">selector</span>) {
    <span style="color:#66d9ef">return</span> document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#a6e22e">selector</span>);
};

<span style="color:#75715e">// use
</span><span style="color:#75715e"></span><span style="color:#a6e22e">node</span>(<span style="color:#e6db74">&#39;#id&#39;</span>); <span style="color:#75715e">// html id
</span><span style="color:#75715e"></span><span style="color:#a6e22e">node</span>(<span style="color:#e6db74">&#39;.class&#39;</span>); <span style="color:#75715e">// html class
</span><span style="color:#75715e"></span><span style="color:#a6e22e">node</span>(<span style="color:#e6db74">&#39;div&#39;</span>); <span style="color:#75715e">// html element
</span></code></pre></div><p>for IE get upload file name</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JavaScript" data-lang="JavaScript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">fileName</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#39;#uploadfile&#39;</span>).<span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">match</span>(<span style="color:#e6db74">/[^\/\\]+$/</span>);
</code></pre></div><p><a href="http://php.net/manual/en/features.file-upload.errors.php">Refer - PHP Error Messages Explained</a></p>

    </main>
</section>


<footer class="p-strip is-wrapper">
    <div class="row">
        <div class="p-article-pagination">
    

    
    <a class="p-article-pagination__link--previous" href="http://blog.tedshd.io/posts/2013-10-12-use-css3-animation-in-compass/">
        <span class="p-article-pagination__label">Previous</span>
        <span class="p-article-pagination__title">
            Use CSS3 animation in Compass
        </span>
    </a>
    

    
    <a class="p-article-pagination__link--next" href="http://blog.tedshd.io/posts/2013-10-23-javascript-handle-json/">
        <span class="p-article-pagination__label">Next</span>
        <span class="p-article-pagination__title">
            JavaScript - handle JSON
        </span>
    </a>
    
</div>
    </div>
</footer>



<div class="p-strip u-no-padding--bottom is-shallow">
    <div class="row">
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "tedshd" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
</div>



        </div><footer class="p-strip is-shallow page-footer">
    <div class="row">
        <div class="col-12  u-align--center">
            <p>
                © 2020 Tedshd
            </p>
        </div>
    </div>
</footer>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-49247550-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>




</body>
</html>
