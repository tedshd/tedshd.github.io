<!DOCTYPE html>
<html lang="en"><head>
    




<title>PHP - Auto update static files cache | tedshd&#39;s DevNote</title>
<meta charset="utf-8">
<meta name="google" content="notranslate">
<meta id="viewport" name="viewport"
    content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="description" content='PHP - Auto update static files cache We can cache static files(CSS, JavaScript) to client
When Server update static code.
We want to update cache then we can modify file or add query string update version.
We have some choice like modify url ?v=1 to ?v=2
But I want to auto modify version.
This is a way i use
 &lt;?php function autoversion($url) {  $ver = stat($_SERVER[&#39;DOCUMENT_ROOT&#39;] . $url)[mtime];  return $url .'>
<meta name="keywords" content=''>
<link rel="alternate" media="only screen and (max-width: 640px)" href="https://blog.tedshd.io/posts/2015-08-16-php-auto-update-static-files-cache/">
<link rel="alternate" media="handheld" href="https://blog.tedshd.io/posts/2015-08-16-php-auto-update-static-files-cache/" />

<link rel="canonical" href="https://blog.tedshd.io/posts/2015-08-16-php-auto-update-static-files-cache/" />
<link rel="shortcut icon" href="/icons/favicon.ico">
<link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-touch-icon-152x152.png">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#007aa6">
<meta name="theme-color" content="">
<meta name="robots" content="index, follow">
<meta name="copyright" content="Tedshd">

<meta property="og:title" content="PHP - Auto update static files cache" />
<meta property="og:description" content="PHP - Auto update static files cache We can cache static files(CSS, JavaScript) to client
When Server update static code.
We want to update cache then we can modify file or add query string update version.
We have some choice like modify url ?v=1 to ?v=2
But I want to auto modify version.
This is a way i use
 &lt;?php function autoversion($url) {  $ver = stat($_SERVER[&#39;DOCUMENT_ROOT&#39;] . $url)[mtime];  return $url ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.tedshd.io/posts/2015-08-16-php-auto-update-static-files-cache/" /><meta property="og:image" content="https://s3.amazonaws.com/logdown-production/system/blog/3202/og_image/logdown.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2015-08-16T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-01-29T17:42:46+08:00" />


<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://s3.amazonaws.com/logdown-production/system/blog/3202/og_image/logdown.png"/>

<meta name="twitter:title" content="PHP - Auto update static files cache"/>
<meta name="twitter:description" content="PHP - Auto update static files cache We can cache static files(CSS, JavaScript) to client
When Server update static code.
We want to update cache then we can modify file or add query string update version.
We have some choice like modify url ?v=1 to ?v=2
But I want to auto modify version.
This is a way i use
 &lt;?php function autoversion($url) {  $ver = stat($_SERVER[&#39;DOCUMENT_ROOT&#39;] . $url)[mtime];  return $url ."/>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-49247550-8', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

<meta itemprop="name" content="">
<meta itemprop="description" content="">
<script data-ad-client="ca-pub-0553186380244641" async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

    
    
    
    
    
    <link rel="stylesheet" href='https://blog.tedshd.io/css/style.css'>

    
<link>

<link
    href="https://fonts.googleapis.com/css?family=Hanuman:400,700|Inconsolata|Roboto:400,400i,700,700i&display=swap&subset=khmer"
    rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.1/grids-min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.1/grids-responsive-min.css">

</head><body><header id="navigation" class="p-navigation">
    <div class="p-navigation__row">
        <div class="p-navigation__banner">
            <div class="p-navigation__logo">
                <a class="p-navigation__link u-vertically-center p-link--logo" href="https://blog.tedshd.io/">
                    tedshd&#39;s DevNote
                </a>
            </div>
            
            <a href="#navigation" class="p-navigation__toggle--open" title="menu">
                <i class="p-icon--menu"></i>
            </a>
            <a href="#navigation-closed" class="p-navigation__toggle--close" title="close menu">
                <i class="p-icon--close"></i>
            </a>
        </div>

        <nav class="p-navigation__nav">
            <span class="u-off-screen">
                <a href="#main-content">Jump to main content</a>
            </span>

            <ul class="p-navigation__links" role="menu">
                
                <li class="p-navigation__link" role="menuitem">
                    <a href="/categories">Categories</a>
                </li>
                
                <li class="p-navigation__link" role="menuitem">
                    <a href="/tags">tags</a>
                </li>
                
            </ul>

            
            <form class="p-search-box" action="https://www.google.com/search" target="_blank">
    <input type="search" class="p-search-box__input" name="q" placeholder='Search'
        required="" aria-label="Query">
    <input type="hidden" name="sitesearch" value="https://blog.tedshd.io/">
    <button type="reset" class="p-search-box__reset" alt="reset" aria-label="Reset">
        <i class="p-icon--close"></i>
    </button>
    <button type="submit" class="p-search-box__button" alt="search" aria-label="Search">
        <i class="p-icon--search"></i>
    </button>
</form>
            
        </nav>
    </div>
</header><div id="main-content">
<div class="page-banner">
    <div class="row u-vertically-center">
        <div class="col-8 pure-g">
            <div class="pure-u">
                <img src="https://graph.facebook.com/100004089951579/picture?type=large" alt="tedshd&#39;s DevNote" width="100" height="100"
                    style="border-radius: 50%;display: inline; margin: 1rem;box-shadow: 0 0 5px rgba(0, 0, 0, 1);vertical-align: middle;">
            </div>
            <div class="pure-u">
                <h2>tedshd&#39;s DevNote</h2>
                <p>Develop &amp; Design Note by Ted</p>
            </div>
        </div>
    </div>
</div>

<ul class="p-navigation__links sub_menu" role="menu">
    
    <li class="p-navigation__link" role="menuitem">
        <a href="http://tedshd.github.io/resume/">About</a>
    </li>
    
    <li class="p-navigation__link" role="menuitem">
        <a href="http://tysh310246.blogspot.tw/">Blog</a>
    </li>
    
    <li class="p-navigation__link" role="menuitem">
        <a href="https://www.facebook.com/chander.shiu">Facebook</a>
    </li>
    
    <li class="p-navigation__link" role="menuitem">
        <a href="https://github.com/tedshd">Github</a>
    </li>
    
    <li class="p-navigation__link" role="menuitem">
        <a href="https://tw.linkedin.com/in/tedshd">Linkedin</a>
    </li>
    
</ul>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<ins class="adsbygoogle" style="display:block;text-align: center;" data-ad-client="ca-pub-0553186380244641"
    data-ad-slot="1505807492" data-ad-format="auto" data-full-width-responsive="true"></ins>
<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>


<header class="">
    <div class="row">
        <h1>PHP - Auto update static files cache</h1>
    </div>
</header>


<section class="p-strip is-shallow">
    <main class="row post-content">
        
        <p class="p-media-object__content">
            <span class="u-capitalized">on</span>
            2015-08-16
        </p>
        
        <h2 id="php---auto-update-static-files-cache">PHP - Auto update static files cache</h2>
<p>We can cache static files(CSS, JavaScript) to client</p>
<p>When Server update static code.</p>
<p>We want to update cache then we can modify file or add query string update version.</p>
<p>We have some choice like modify url <code>?v=1</code> to <code>?v=2</code></p>
<p>But I want to auto modify version.</p>
<p>This is a way i use</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">autoversion</span>($url) {
</span></span><span style="display:flex;"><span>    $ver <span style="color:#f92672">=</span> <span style="color:#a6e22e">stat</span>($_SERVER[<span style="color:#e6db74">&#39;DOCUMENT_ROOT&#39;</span>] <span style="color:#f92672">.</span> $url)[<span style="color:#a6e22e">mtime</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> $url <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34;?v=&#34;</span> <span style="color:#f92672">.</span> $ver;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e"># example
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">&lt;link href=&#34;&lt;?php echo autoversion(&#39;/path/to/theme.css&#39;); ?&gt;&#34; rel=&#34;stylesheet&#34;&gt;
</span></span></span></code></pre></div><p>This way use file last modify time as a version.</p>
<p><del>First i want to use <code>filemtime</code> but it fail.</del></p>
<p><del>So i give up this way.</del></p>
<h3 id="update">Update</h3>
<p>Before use <code>filemtime()</code>, must use <code>clearstatcache();</code></p>
<p>And my friend say <code>stat</code> has IO behavior, so this way is not perfect solution.</p>
<p>If service has lot of <code>stat()</code> or mass request, so many IO can influences performance.</p>
<p>Then we can write a script add update version and run it when service deploy.</p>
<p><a href="https://css-tricks.com/strategies-for-cache-busting-css/">Refer - Strategies for Cache-Busting CSS</a></p>
<p><a href="http://php.net/manual/en/function.stat.php">Refer - stat</a></p>
<p><a href="http://php.net/manual/en/function.filemtime.php">filemtime</a></p>

    </main>
</section>

<footer class="p-strip is-wrapper">
    <div class="row">
        <div class="p-article-pagination">
    
    <a class="p-article-pagination__link--previous" href="https://blog.tedshd.io/posts/2015-08-15-javascript-google-closure-compiler-vs-gulp-uglify/">
        <span class="p-article-pagination__label">Previous</span>
        <span class="p-article-pagination__title">
            JavaScript - Google Closure Compiler V.S. Gulp uglify
        </span>
    </a>
    

    
    <a class="p-article-pagination__link--next" href="https://blog.tedshd.io/posts/2015-08-28-javascript-something-about-childnodes-and-nextsibling-why-they-get-dom-is-not-as-you-imagine/">
        <span class="p-article-pagination__label">Next</span>
        <span class="p-article-pagination__title">
            JavaScript - something about childNodes and nextSibling why they get DOM is not as you imagine
        </span>
    </a>
    
</div>
    </div>
</footer>

        </div><footer class="p-strip is-shallow page-footer">
    <div class="row">
        <div class="col-12  u-align--center">
            <p>
                Â© 2020 Tedshd
            </p>
        </div>
    </div>
</footer>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-49247550-8', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>




</body>
</html>
