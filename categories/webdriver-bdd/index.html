<!DOCTYPE html>
<html lang="en"><head>
    




<title>webdriver BDD | tedshd&#39;s DevNote</title>
<meta charset="utf-8">
<meta name="google" content="notranslate">
<meta id="viewport" name="viewport"
    content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="description" content='Develop &amp; Design Note by Ted'>
<meta name="keywords" content=''>
<link rel="alternate" media="only screen and (max-width: 640px)" href="https://blog.tedshd.io/categories/webdriver-bdd/">
<link rel="alternate" media="handheld" href="https://blog.tedshd.io/categories/webdriver-bdd/" />

<link rel="canonical" href="https://blog.tedshd.io/categories/webdriver-bdd/" />
<link rel="shortcut icon" href="/icons/favicon.ico">
<link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-touch-icon-152x152.png">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#007aa6">
<meta name="theme-color" content="">
<meta name="robots" content="index, follow">
<meta name="copyright" content="Tedshd">

<meta property="og:title" content="webdriver BDD" />
<meta property="og:description" content="Develop &amp; Design Note by Ted" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://blog.tedshd.io/categories/webdriver-bdd/" />
<meta property="og:image" content="https://s3.amazonaws.com/logdown-production/system/blog/3202/og_image/logdown.png"/>
<meta property="og:updated_time" content="2020-01-29T17:42:46+08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://s3.amazonaws.com/logdown-production/system/blog/3202/og_image/logdown.png"/>

<meta name="twitter:title" content="webdriver BDD"/>
<meta name="twitter:description" content="Develop &amp; Design Note by Ted"/>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-49247550-8', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

<meta itemprop="name" content="">
<meta itemprop="description" content="">

<script data-ad-client="ca-pub-0553186380244641" async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

    
    
    <link href="/categories/webdriver-bdd/index.xml" rel="alternate" type="application/rss+xml" title="tedshd&#39;s DevNote" />
    
    
    
    
    <link rel="stylesheet" href='https://blog.tedshd.io/css/style.css'>

    
<link>

<link
    href="https://fonts.googleapis.com/css?family=Hanuman:400,700|Inconsolata|Roboto:400,400i,700,700i&display=swap&subset=khmer"
    rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.1/grids-min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.1/grids-responsive-min.css">

</head><body><header id="navigation" class="p-navigation">
    <div class="p-navigation__row">
        <div class="p-navigation__banner">
            <div class="p-navigation__logo">
                <a class="p-navigation__link u-vertically-center p-link--logo" href="https://blog.tedshd.io/">
                    tedshd&#39;s DevNote
                </a>
            </div>
            
            <a href="#navigation" class="p-navigation__toggle--open" title="menu">
                <i class="p-icon--menu"></i>
            </a>
            <a href="#navigation-closed" class="p-navigation__toggle--close" title="close menu">
                <i class="p-icon--close"></i>
            </a>
        </div>

        <nav class="p-navigation__nav">
            <span class="u-off-screen">
                <a href="#main-content">Jump to main content</a>
            </span>

            <ul class="p-navigation__links" role="menu">
                
                <li class="p-navigation__link" role="menuitem">
                    <a href="/categories">Categories</a>
                </li>
                
                <li class="p-navigation__link" role="menuitem">
                    <a href="/tags">tags</a>
                </li>
                
            </ul>

            
            <form class="p-search-box" action="https://www.google.com/search" target="_blank">
    <input type="search" class="p-search-box__input" name="q" placeholder='Search'
        required="" aria-label="Query">
    <input type="hidden" name="sitesearch" value="https://blog.tedshd.io/">
    <button type="reset" class="p-search-box__reset" alt="reset" aria-label="Reset">
        <i class="p-icon--close"></i>
    </button>
    <button type="submit" class="p-search-box__button" alt="search" aria-label="Search">
        <i class="p-icon--search"></i>
    </button>
</form>
            
        </nav>
    </div>
</header><div id="main-content">



<div class="page-banner">
    <div class="row">
        <h1>
            <span class="u-capitalized">category</span>:
            webdriver BDD
        </h1>
        
    </div>
</div>



<ul class="p-navigation__links sub_menu" role="menu">
    
    <li class="p-navigation__link" role="menuitem">
        <a href="http://tedshd.github.io/resume/">About</a>
    </li>
    
    <li class="p-navigation__link" role="menuitem">
        <a href="http://tysh310246.blogspot.tw/">Blog</a>
    </li>
    
    <li class="p-navigation__link" role="menuitem">
        <a href="https://www.facebook.com/chander.shiu">Facebook</a>
    </li>
    
    <li class="p-navigation__link" role="menuitem">
        <a href="https://github.com/tedshd">Github</a>
    </li>
    
    <li class="p-navigation__link" role="menuitem">
        <a href="https://tw.linkedin.com/in/tedshd">Linkedin</a>
    </li>
    
</ul>






<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<ins class="adsbygoogle" style="display:block;text-align: center;" data-ad-client="ca-pub-0553186380244641"
    data-ad-slot="1505807492" data-ad-format="auto" data-full-width-responsive="true"></ins>
<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>

<div class="p-strip is-wrapper posts">
    <div class="row">
        

        

        <div class="col-12">
            <div class="p-card">
                <h3><a href="https://blog.tedshd.io/posts/2016-07-19-webdriverio-introduction-to-front-end-test-notes/">webdriver.io - 前端測試入門筆記&hellip;</a></h3>

                
                
                <p>


<span class=" u-capitalized ">
    on
</span>
2016-07-19
</p>
                

                
                <p><h2 id="webdriverio---前端測試入門筆記">webdriver.io - 前端測試入門筆記&hellip;</h2>
<p>前端測試工具很多種</p>
<p>我這裡的需求是要做自動化測試</p>
<p>不知為何就選了這套 <a href="http://webdriver.io/">webdriver.io</a></p>
<p>可能就只是單純名字很炫(誤</p>
<p>當然一開始要先要有 <a href="http://www.seleniumhq.org/">Selenium</a></p>
<p>但為何 Selenium 跟我以前的印象有差別了&hellip;</p>
<p>我發現它的 firefox add-on 不能把錄製的動作輸出成 code 了, 是我的錯覺嗎?還是改方式了</p>
<p>但我想說就算了, 直接用寫的也罷</p>
<p>webdriver.io 只是因為是在我看過的關於測試文章中最後有印象的東西所以就去找它了(這是事實&hellip;</p>
<p>也還好我的記憶沒錯, 看了介紹和文件覺得 webdriver.io 有符合我的需求且又是用 Node.js 來寫, 所以對我較友善</p>
<p>先記錄一下使用流程</p>
<h3 id="base-tool">Base tool</h3>
<ul>
<li>Java</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo apt-get update

java -version

sudo apt-get install default-jre

sudo apt-get install default-jdk
</code></pre></div><ul>
<li>Node.js</li>
</ul>
<p><a href="https://nodejs.org/en/download/package-manager/">Install</a></p>
<h3 id="on-local">On Local</h3>
<p><a href="http://webdriver.io/guide.html">Get Started</a></p>
<p>突然發現文件寫得很詳細了&hellip;</p>
<p>雖然在做設定那有些選項不同但也影響不大</p>
<p>但想玩進階的方式可參考以下文章</p>
<p><a href="https://siteobservers.zendesk.com/hc/en-us/articles/201989070-Start-selenium-server-with-additional-command-line-arguments">設定 Selenium 參數可參考</a></p>
<p>基本上以下是我建的順序</p>
<h4 id="1-先建-packagejson">1 先建 <code>package.json</code></h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;webdriver&#34;</span>,
  <span style="color:#e6db74">&#34;description&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;automation test&#34;</span>,
  <span style="color:#e6db74">&#34;devDependencies&#34;</span><span style="color:#f92672">:</span> {
  }
}
</code></pre></div><h4 id="2-下載-selenium-server">2 下載 Selenium server</h4>
<p>之後有新版請再去確認版本</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">curl -O http://selenium-release.storage.googleapis.com/2.53/selenium-server-standalone-2.53.0.jar
</code></pre></div><h4 id="3-裝-webdriver">3 裝 webdriver</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">npm install webdriverio --save-dev
</code></pre></div><h4 id="4-安裝各個-os-對應的-webdriver">4 安裝各個 OS 對應的 webdriver</h4>
<p><a href="https://www.npmjs.com/package/selenium-webdriver">selenium-webdriver</a></p>
<p>可以不必裝 <code>selenium-webdriver</code></p>
<p>只要去下載各個 OS 對應要用的 browser 的 webdriver 放在專案資料夾就好了</p>
<h4 id="5-這樣就好了">5 這樣就好了</h4>
<h4 id="6-啟動-selenium-server-並開始寫一個簡單的自動化測試的-test-case">6 啟動 Selenium server 並開始寫一個簡單的自動化測試的 test case</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">java -jar selenium-server-standalone-2.53.0.jar
</code></pre></div><p><code>test.js</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JavaScript" data-lang="JavaScript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">webdriverio</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;webdriverio&#39;</span>);
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">options</span> <span style="color:#f92672">=</span> {
    <span style="color:#a6e22e">desiredCapabilities</span><span style="color:#f92672">:</span> {
        <span style="color:#a6e22e">browserName</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;firefox&#39;</span>
    }
};

<span style="color:#a6e22e">webdriverio</span>
    .<span style="color:#a6e22e">remote</span>(<span style="color:#a6e22e">options</span>)
    .<span style="color:#a6e22e">init</span>()
    .<span style="color:#a6e22e">url</span>(<span style="color:#e6db74">&#39;http://www.google.com&#39;</span>)
    .<span style="color:#a6e22e">getTitle</span>().<span style="color:#a6e22e">then</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">title</span>) {
        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;Title was: &#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">title</span>);
    })
    .<span style="color:#a6e22e">end</span>();
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">node test.js
// output Title was: Google
</code></pre></div><p>這時你就會發現你的 firefox 被打開連到 Google 後就自動關掉</p>
<p>然後 terminal 就會 output <code>Title was: Google</code></p>
<p>關於測試的的 script 攥寫請參考 API 文件</p>
<p><a href="http://webdriver.io/api.html">WebdriverIO - API Docs</a></p>
<p>我預設使用 <a href="https://mochajs.org/">mocha</a></p>
<p>有用 <a href="http://chaijs.com/">chai</a> 加強攥寫 script</p>
<h3 id="進階應用">進階應用</h3>
<p>基本上 webdriver 分兩種測試方式</p>
<ol>
<li>
<p>Standalone Mode</p>
</li>
<li>
<p>The WDIO Testrunner</p>
</li>
</ol>
<p>各有優缺點, 就看習慣用哪種方式來跑測試</p>
<p>我較喜歡用 The WDIO 的方式, 因為他是把設定檔抽出來, 較好管理且可用 hook 做其他事情</p>
<p>依我所做的較特別的設定就是把 test case 切很細(因為測試的 scope 需求), 這就需要設定能跑個別的測試</p>
<p>就需要在 config 設定 <code>suites</code></p>
<p>就可以這樣下 command</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">./node_modules/.bin/wdio wdio.conf.js --suite test_a
// or
./node_modules/.bin/wdio wdio.conf.js --suite test_b
</code></pre></div><p>可參考以下文件</p>
<p><a href="http://webdriver.io/guide/getstarted/configuration.html">WebdriverIO - Configuration</a></p>
<p><a href="http://webdriver.io/guide/testrunner/gettingstarted.html">WebdriverIO - Test Runner</a></p>
<p>一般都會要把測試結果 output 出來, webdriver 提供自訂 reporter 的功能</p>
<p>就看個人喜好選擇</p>
<p><a href="http://webdriver.io/guide/reporters/dot.html">WebdriverIO - Dot Reporter</a></p>
<p>但我這需求簡單且需要讓其他人可在測試當下就輕易看到結果, 所以就在 config 設定 hook</p>
<p>讓測試跑完時儲存測試結果並有個頁面讓別人看</p>
<p>config 的 hook</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JavaScript" data-lang="JavaScript"><span style="color:#a6e22e">afterTest</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">test</span>) {
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;HOOK - afterTest:&#39;</span>, <span style="color:#a6e22e">test</span>);
},
</code></pre></div><p>test 就是測試結果</p>
<p>hook 也有很多狀態可用</p>
<h3 id="strong-stylecolorred廢棄方法因為一直試驗失敗strong"><!-- raw HTML omitted -->廢棄方法(因為一直試驗失敗&hellip;<!-- raw HTML omitted --></h3>
<h3 id="on-remote-server">On remote Server</h3>
<p>基本上用 webdriver 做測試是需要有 browser 和 UI</p>
<p>所以需裝 xwindow 或 Xvfb</p>
<h4 id="firefox">firefox</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo apt search firefox

sudo apt-get install firefox firefox-locale-en
</code></pre></div><p>如果顯示</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">Gtk-WARNING **: Locale not supported by C library.
    Using the fallback <span style="color:#e6db74">&#39;C&#39;</span> locale.
</code></pre></div><p>請設定 locale</p>
<p>我是設定 en_US</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">export LC_ALL<span style="color:#f92672">=</span>en_US.UTF-8
</code></pre></div><h4 id="xvfb"><del>xvfb</del></h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo apt-get install xvfb
<span style="color:#e6db74">```</span>shell

然後啟動與指派到哪個 port

<span style="color:#e6db74">```</span>shell
sudo Xvfb :10 -ac
</code></pre></div><p>指定輸出的 DISPLAY</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">export DISPLAY<span style="color:#f92672">=</span>:10
firefox
</code></pre></div><p>之後再啟動測試</p>
<p>但</p>
<p>這裡就遇到問題了</p>
<p>出現錯誤訊息&hellip;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">Error: no display specified
</code></pre></div><p>但奇怪的是明明都 export DISPLAY 了還出這 error&hellip;</p>
<p>目前都還沒解決這問題&hellip;</p>
<p>所以直接採用下面的兩個備案</p>
<ol>
<li>
<p>裝一台有 GUI 的 Linux 到實體機器上, 非 VM</p>
</li>
<li>
<p>使用 <a href="https://saucelabs.com/">SAUCE LABS</a></p>
</li>
</ol>
<p>個人是建議公司肯出錢就採用 SAUCE LABS 的服務, 隨然有點小貴, 因為涵蓋的 OS 和 browser 很多, 且有 mobile web 的測試(雖然 android  都只有到 4.X 而已</p>
<p>下面說明一下如何設定 SAUCE LABS 與 SAUCE LABS 是如何運作的</p>
<h3 id="sauce-labs">SAUCE LABS</h3>
<p>SAUCE LABS 提供多個 OS 與 browser 版本的 VM 以供測試且有 native app 的測試</p>
<p>有 14 天的免費試用, 且有 opensource 的 free 方案</p>
<p>在 price 方面須注意的是 Manual 的方案是不含自動化測試的</p>
<p>他有提供 API 去處理測試結果與資訊, 但因為我不會用到所以就沒細看有哪些功能</p>
<p>基本上使用 SAUCE LABS 的流程如下</p>
<p><img src="http://user-image.logdown.io/user/3170/blog/3202/post/774036/8YR4x8nTOSagnQ0MoRx2_test.png" alt="test.png"></p>
<p>基本上就是連上 SAUCE LABS 的 host 用 SAUCE LABS 的 VM 測試</p>
<p>下面會說一下設定方式</p>
<p>跟跑 webdriver 一樣設定可分兩種去 run</p>
<ol>
<li>
<p>Standalone Mode</p>
</li>
<li>
<p>The WDIO Testrunner</p>
</li>
</ol>
<p>1 可參考官方文件</p>
<p><a href="https://wiki.saucelabs.com/display/DOCS/Node.js+Test+Setup+Example">Node.js Test Setup Example - The Sauce Labs Cookbook - Sauce Labs Documentation Wiki</a></p>
<p>我是採用 2</p>
<p>所以需追加的設定是</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#960050;background-color:#1e0010">capabilities:</span> [{
    <span style="color:#960050;background-color:#1e0010">&#39;browserName&#39;:</span> <span style="color:#960050;background-color:#1e0010">&#39;chrome&#39;,</span>
    <span style="color:#960050;background-color:#1e0010">&#39;platform&#39;:</span> <span style="color:#960050;background-color:#1e0010">&#39;Windows</span> <span style="color:#960050;background-color:#1e0010">10&#39;,</span>
    <span style="color:#960050;background-color:#1e0010">&#39;username&#39;:</span> <span style="color:#960050;background-color:#1e0010">&lt;username&gt;,</span>
    <span style="color:#960050;background-color:#1e0010">&#39;accessKey&#39;:</span> <span style="color:#960050;background-color:#1e0010">&lt;accessKey&gt;</span>
}]<span style="color:#960050;background-color:#1e0010">,</span>

<span style="color:#960050;background-color:#1e0010">host:</span> <span style="color:#960050;background-color:#1e0010">&lt;username&gt;</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#960050;background-color:#1e0010">&#39;:&#39;</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#960050;background-color:#1e0010">&lt;accessKey&gt;</span> <span style="color:#960050;background-color:#1e0010">+</span> <span style="color:#960050;background-color:#1e0010">&#39;@ondemand.saucelabs.com&#39;,</span>
<span style="color:#960050;background-color:#1e0010">port:</span> <span style="color:#ae81ff">80</span><span style="color:#960050;background-color:#1e0010">,</span>
<span style="color:#960050;background-color:#1e0010">path:</span> <span style="color:#960050;background-color:#1e0010">&#39;/wd/hub&#39;,</span>

</code></pre></div><p><code>&lt;username&gt;</code> 和 <code>&lt;accessKey&gt;</code> 都可以經由 SAUCE LABS 後台取得</p>
<p>這樣就可以使用 SAUCE LABS 來跑測試程式了</p>
<h3 id="note">Note</h3>
<p>當你一段時間沒跑, 之後又再跑時有錯</p>
<p>有可能向我遇到JAVA 更新</p>
<p>那這時 <code>Selenium Standalone Server</code> 就要更新 <a href="http://www.seleniumhq.org/download/">Link</a></p>
<p>browser driver 也要更新</p>
<p><a href="http://slides.com/alincode/jsdc2016_webdriverio/fullscreen#/">2016 JSDC 淺談網站自動化測試</a></p>
</p>
                

                

                
                <p><a href="https://blog.tedshd.io/posts/2016-07-19-webdriverio-introduction-to-front-end-test-notes/">Read more</a></p>
                
            </div>
        </div>
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        
        
        
    </div>
</div>

<div class="p-strip is-wrapper">
    <div class="row">
        <footer class="p-article-pagination">
    

    
</footer>
    </div>
</div>


        </div><footer class="p-strip is-shallow page-footer">
    <div class="row">
        <div class="col-12  u-align--center">
            <p>
                © 2020 Tedshd
            </p>
        </div>
    </div>
</footer>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-49247550-8', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>




</body>
</html>
